<div id="schedulerModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50">
    <div class="bg-white rounded-lg p-6 max-w-md mx-auto mt-20">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-medium">Schedule New Automation</h3>
            <button onclick="document.getElementById('schedulerModal').classList.add('hidden')" 
                    class="text-gray-500 hover:text-gray-700">
                &times;
            </button>
        </div>
        <form id="taskForm" data-business-id="">
            <input type="hidden" name="business_id" id="businessIdInput">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Task Type</label>
                    <select name="task_type" class="w-full border rounded p-2" required>
                        <option value="POST">Social Post</option>
                        <option value="PHOTO">Photo Upload</option>
                        <option value="REVIEW">Review Monitoring</option>
                        <option value="QA">QA Check</option>
                        <option value="COMPLIANCE">Compliance Check</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Frequency</label>
                    <select name="frequency" class="w-full border rounded p-2" 
                            onchange="document.getElementById('customDate').style.display = this.value === 'CUSTOM' ? 'block' : 'none'">
                        <option value="DAILY">Daily</option>
                        <option value="WEEKLY">Weekly</option>
                        <option value="MONTHLY">Monthly</option>
                        <option value="CUSTOM">Custom</option>
                    </select>
                </div>
                <div id="customDate" style="display: none;">
                    <label class="block text-sm font-medium mb-1">Date and Time</label>
                    <input type="datetime-local" name="custom_time" class="w-full border rounded p-2">
                </div>
                <button type="button" onclick="handleScheduleTask(this)" 
                        class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Schedule Task
                </button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    window.showSchedulerModal = (businessId) => {
        console.log('[INFO] showSchedulerModal called with businessId:', businessId);
        if (!businessId) {
            console.error('[ERROR] showSchedulerModal called without businessId');
            return;
        }
        
        const modal = document.getElementById('schedulerModal');
        // Close any existing modals first
        document.querySelectorAll('.modal-open').forEach(m => m.classList.add('hidden'));
        
        modal.querySelector('#businessIdInput').value = businessId;
        modal.dataset.businessId = businessId;
        console.log('[INFO] Showing modal for business:', businessId);
        modal.classList.remove('hidden');
        // Add backdrop filter for better visual focus
        modal.classList.add('backdrop-blur-sm');
    };

    window.handleScheduleTask = (button) => {
        console.log('[INFO] handleScheduleTask called');
        const form = button.closest('form');
        const businessId = form.dataset.businessId;
        console.log('[INFO] Processing task for business:', businessId);
        
        if (!businessId) {
            console.error('[ERROR] No businessId found in form');
            return;
        }
        
        const taskData = new FormData(form);
        console.log('[INFO] Task data:', Object.fromEntries(taskData.entries()));
        
        // Add your task creation logic here
        console.log('Creating task for business:', businessId, taskData);
        
        // Close modal after submission
        const modal = document.getElementById('schedulerModal');
        modal.classList.add('hidden');
        modal.classList.remove('backdrop-blur-sm');
    };
});
</script>
