<html><head><base href="." /><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Knowledge Base - GBP Automation Pro</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/main.min.css">
<style>
:root {
  --primary: #4285f4;
  --secondary: #34a853;
  --warning: #fbbc05;
  --danger: #ea4335;
  --dark: #202124;
  --light: #ffffff;
  --gray: #5f6368;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Google Sans', Arial, sans-serif;
}

body {
  background: #f8f9fa;
}

.dashboard {
  display: grid;
  min-height: 100vh;
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;
}

.sidebar {
  position: fixed;
  height: 100vh;
  width: 250px;
  background: var(--dark);
  color: var(--light);
  padding: 1.5rem 1.5rem 5rem 1.5rem;
  overflow-y: auto;
  transition: transform 0.3s ease;
}

.sidebar.closed {
  transform: translateX(-100%);
}

.nav-item {
  padding: 1rem;
  margin: 0.5rem 0;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  transition: all 0.3s ease;
}

.nav-item:hover {
  background: rgba(255, 255, 255, 0.1);
}

.nav-item.active {
  background: var(--primary);
}

.nav-item i {
  font-size: 1.2rem;
  width: 24px;
}

.main-content {
  margin-left: 250px;
  padding: 2rem;
  width: calc(100% - 250px);
  max-width: 100%;
  display: grid;
  gap: 2rem;
}

.kb-overview {
  background: white;
  border-radius: 12px;
  padding: 2rem;
  margin-bottom: 2rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.kb-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.stat-card {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.5rem;
  background: #f8f9fa;
  border-radius: 8px;
  transition: transform 0.2s;
}

.stat-card:hover {
  transform: translateY(-2px);
}

.stat-card i {
  font-size: 2rem;
  color: var(--primary);
}

.stat-value {
  font-size: 1.5rem;
  font-weight: bold;
  color: var(--dark);
}

.stat-label {
  color: var(--gray);
}

.kb-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  margin-bottom: 2rem;
}

.vector-graph-container {
  background: white;
  border-radius: 12px;
  padding: 2rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

#vectorGraph {
  width: 100%;
  height: 400px;
  background: #f8f9fa;
  border-radius: 8px;
  margin: 1rem 0;
}

.graph-legend {
  display: flex;
  gap: 1rem;
  margin-top: 1rem;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
}

.dot.document { background: var(--primary); }
.dot.concept { background: var(--secondary); }
.dot.relation { background: var(--warning); }

.file-management {
  background: white;
  border-radius: 12px;
  padding: 2rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.upload-zone {
  border: 2px dashed #ddd;
  border-radius: 8px;
  padding: 2rem;
  text-align: center;
  margin-bottom: 1.5rem;
  transition: border-color 0.2s;
}

.upload-zone.drag-over {
  border-color: var(--primary);
  background: rgba(66,133,244,0.1);
}

.upload-zone i {
  font-size: 3rem;
  color: var(--gray);
  margin-bottom: 1rem;
}

.upload-btn {
  margin-top: 1rem;
  padding: 0.75rem 1.5rem;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.file-browser {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 1.5rem;
}

.file-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.search-bar {
  position: relative;
  flex: 1;
  margin-right: 1rem;
}

.search-bar input {
  width: 100%;
  padding: 0.75rem;
  padding-left: 2.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.search-bar i {
  position: absolute;
  left: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  color: var(--gray);
}

.view-options {
  display: flex;
  gap: 0.5rem;
}

.view-options i {
  padding: 0.5rem;
  cursor: pointer;
  color: var(--gray);
}

.view-options i.active {
  color: var(--primary);
}

.file-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 1rem;
}

.company-info {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin-top: 2rem;
}

.info-section {
  background: white;
  border-radius: 12px;
  padding: 2rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.news-feed {
  margin-top: 1rem;
}

/* Media queries for responsive design */
@media screen and (max-width: 768px) {
  .dashboard {
    grid-template-columns: 1fr;
  }
  
  .sidebar {
    display: none;
  }
  
  .main-content {
    margin-left: 0;
    width: 100%;
  }
}

/* Add to existing CSS */
.user-profile {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 250px;
  padding: 1rem;
  background: var(--dark);
  border-top: 1px solid rgba(255,255,255,0.1);
  display: flex;
  align-items: center;
  gap: 1rem;
}

.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
}

.user-info {
  flex: 1;
}

.username {
  color: var(--light);
  font-weight: 500;
}

.credits {
  color: var(--gray);
  font-size: 0.9rem;
}

.notifications-content {
  padding: 2rem;
}

.notifications-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.notification-actions {
  display: flex;
  gap: 1rem;
}

.action-btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 4px;
  background: var(--primary);
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.2s;
}

.action-btn:hover {
  background: #3367d6;
}

.notifications-grid {
  display: grid;
  gap: 2rem;
}

.notification-group {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.notification-group h3 {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
  color: var(--dark);
}

.notification-group.urgent h3 i {
  color: var(--danger);
}

.notification-group.important h3 i {
  color: var(--warning);
}

.notification-group.regular h3 i {
  color: var(--primary);
}

.notification-item {
  padding: 1rem;
  border-radius: 8px;
  background: #f8f9fa;
  margin-bottom: 1rem;
  transition: all 0.2s;
}

.notification-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.notification-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 0.5rem;
}

.notification-title {
  font-weight: 500;
}

.notification-time {
  font-size: 0.9rem;
  color: var(--gray);
}

.notification-content {
  color: var(--gray);
  margin-bottom: 1rem;
}

.notification-actions {
  display: flex;
  gap: 0.5rem;
}

.notification-btn {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.2s;
}

.solve-btn {
  background: var(--secondary);
  color: white;
}

.archive-btn {
  background: var(--gray);
  color: white;
}

.delete-btn {
  background: var(--danger);
  color: white;
}
</style>
</head>
<body>
<div class="dashboard">
  <aside class="sidebar" id="sidebar">
    <div class="logo">GBP Automation Pro</div>
    <nav>
      <div class="nav-item">
        <i class="fas fa-home"></i>
        Overview
      </div>
      <div class="nav-item active">
        <i class="fas fa-book"></i>
        Knowledge Base
      </div>
      <div class="nav-item">
        <i class="fas fa-file-alt"></i>
        Content Management
      </div>
      <div class="nav-item">
        <i class="fas fa-chart-bar"></i>
        Analytics
      </div>
      <div class="nav-item">
        <i class="fas fa-bell"></i>
        Notifications
      </div>
    </nav>
    <div class="user-profile">
      <img src="" alt="User avatar" class="avatar" id="userAvatar">
      <div class="user-info">
        <div class="username" id="username"></div>
        <div class="credits" id="userCredits"></div>
      </div>
    </div>
    <div class="sidebar-toggle" id="sidebarToggle">
      <i class="fas fa-chevron-left" id="toggleArrow"></i>
    </div>
  </aside>
  
  <main class="main-content">
    <div class="kb-overview">
      <h2>Knowledge Base Overview</h2>
      <div class="kb-stats">
        <div class="stat-card">
          <i class="fas fa-file"></i>
          <div class="stat-info">
            <div class="stat-value" id="totalDocuments">0</div>
            <div class="stat-label">Total Documents</div>
          </div>
        </div>
        <div class="stat-card">
          <i class="fas fa-network-wired"></i>
          <div class="stat-info">
            <div class="stat-value" id="vectorCount">0</div>
            <div class="stat-label">Vector Embeddings</div>
          </div>
        </div>
        <div class="stat-card">
          <i class="fas fa-brain"></i>
          <div class="stat-info">
            <div class="stat-value" id="llmQueries">0</div>
            <div class="stat-label">LLM Queries</div>
          </div>
        </div>
      </div>
    </div>

    <div class="kb-grid">
      <div class="vector-graph-container">
        <h3>Knowledge Graph</h3>
        <div id="vectorGraph"></div>
        <div class="graph-legend">
          <div class="legend-item">
            <span class="dot document"></span> Documents
          </div>
          <div class="legend-item">
            <span class="dot concept"></span> Concepts
          </div>
          <div class="legend-item">
            <span class="dot relation"></span> Relations
          </div>
        </div>
      </div>

      <div class="file-management">
        <h3>Document Management</h3>
        <div class="upload-zone" id="uploadZone">
          <i class="fas fa-cloud-upload-alt"></i>
          <p>Drag & drop files or folders here</p>
          <p>Supported formats: PDF, DOCX, TXT, CSV, JSON, Images</p>
          <input type="file" id="fileInput" multiple webkitdirectory directory>
          <button class="upload-btn">Select Files</button>
        </div>
        
        <div class="file-browser">
          <div class="file-header">
            <div class="search-bar">
              <input type="text" placeholder="Search documents...">
              <i class="fas fa-search"></i>
            </div>
            <div class="view-options">
              <i class="fas fa-th-large active"></i>
              <i class="fas fa-list"></i>
            </div>
          </div>
          <div class="file-grid" id="fileGrid">
            <!-- Files will be populated here -->
          </div>
        </div>
      </div>
    </div>

    <div class="company-info">
      <div class="info-section">
        <h3>Company Overview</h3>
        <div class="info-content" id="companyOverview">
          <!-- Company overview content -->
        </div>
      </div>
      <div class="info-section">
        <h3>Operations News</h3>
        <div class="news-feed" id="operationsNews">
          <!-- News items -->
        </div>
      </div>
    </div>

    <div class="notifications-content" style="display: none;">
      <div class="notifications-header">
        <h2>Notifications</h2>
        <div class="notification-actions">
          <button class="action-btn" onclick="markAllRead()">
            <i class="fas fa-check-double"></i> Mark All Read
          </button>
          <button class="action-btn" onclick="archiveAll()">
            <i class="fas fa-archive"></i> Archive All
          </button>
        </div>
      </div>

      <div class="notifications-grid">
        <!-- Urgent Notifications -->
        <div class="notification-group urgent">
          <h3><i class="fas fa-exclamation-circle"></i> Urgent (Next 24 Hours)</h3>
          <div class="notification-list" id="urgentNotifications">
            <!-- Urgent notifications will be populated here -->
          </div>
        </div>

        <!-- Important Notifications -->
        <div class="notification-group important">
          <h3><i class="fas fa-clock"></i> Important (This Week)</h3>
          <div class="notification-list" id="importantNotifications">
            <!-- Important notifications will be populated here -->
          </div>
        </div>

        <!-- Regular Notifications -->
        <div class="notification-group regular">
          <h3><i class="fas fa-bell"></i> Regular Updates</h3>
          <div class="notification-list" id="regularNotifications">
            <!-- Regular notifications will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.8/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@6.1.8/main.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
// Initialize vector graph visualization using D3.js
function initVectorGraph() {
  const width = document.getElementById('vectorGraph').clientWidth;
  const height = 400;
  
  // Create SVG
  const svg = d3.select('#vectorGraph')
    .append('svg')
    .attr('width', width)
    .attr('height', height);

  // Sample data - replace with real data from your vector database
  const data = {
    nodes: [
      {id: "doc1", type: "document", title: "Company Overview"},
      {id: "doc2", type: "document", title: "Marketing Strategy"},
      {id: "concept1", type: "concept", title: "Brand Identity"},
      {id: "concept2", type: "concept", title: "Customer Engagement"},
      {id: "concept3", type: "concept", title: "Market Analysis"},
      {id: "relation1", type: "relation", title: "Influences"},
      {id: "relation2", type: "relation", title: "Defines"}
    ],
    links: [
      {source: "doc1", target: "concept1"},
      {source: "doc1", target: "concept2"},
      {source: "doc2", target: "concept2"},
      {source: "doc2", target: "concept3"},
      {source: "concept1", target: "relation1"},
      {source: "concept2", target: "relation2"}
    ]
  };

  // Create force simulation
  const simulation = d3.forceSimulation(data.nodes)
    .force("link", d3.forceLink(data.links).id(d => d.id).distance(100))
    .force("charge", d3.forceManyBody().strength(-200))
    .force("center", d3.forceCenter(width / 2, height / 2));

  // Draw links
  const links = svg.append("g")
    .selectAll("line")
    .data(data.links)
    .join("line")
    .style("stroke", "#999")
    .style("stroke-width", 1);

  // Draw nodes
  const nodes = svg.append("g")
    .selectAll("circle")
    .data(data.nodes)
    .join("circle")
    .attr("r", 8)
    .style("fill", d => {
      switch(d.type) {
        case "document": return "#4285f4";
        case "concept": return "#34a853";
        case "relation": return "#fbbc05";
      }
    })
    .call(drag(simulation));

  // Add node titles
  nodes.append("title")
    .text(d => d.title);

  // Update positions
  simulation.on("tick", () => {
    links
      .attr("x1", d => d.source.x)
      .attr("y1", d => d.source.y)
      .attr("x2", d => d.target.x)
      .attr("y2", d => d.target.y);

    nodes
      .attr("cx", d => d.x)
      .attr("cy", d => d.y);
  });

  // Drag functionality
  function drag(simulation) {
    function dragstarted(event) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      event.subject.fx = event.subject.x;
      event.subject.fy = event.subject.y;
    }
    
    function dragged(event) {
      event.subject.fx = event.x;
      event.subject.fy = event.y;
    }
    
    function dragended(event) {
      if (!event.active) simulation.alphaTarget(0);
      event.subject.fx = null;
      event.subject.fy = null;
    }
    
    return d3.drag()
      .on("start", dragstarted)
      .on("drag", dragged)
      .on("end", dragended);
  }
}

// File upload handling
function initFileUpload() {
  const uploadZone = document.getElementById('uploadZone');
  const fileInput = document.getElementById('fileInput');
  
  uploadZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadZone.classList.add('drag-over');
  });
  
  uploadZone.addEventListener('dragleave', () => {
    uploadZone.classList.remove('drag-over');
  });
  
  uploadZone.addEventListener('drop', async (e) => {
    e.preventDefault();
    uploadZone.classList.remove('drag-over');
    
    const files = e.dataTransfer.files;
    await handleFiles(files);
  });
  
  fileInput.addEventListener('change', async () => {
    await handleFiles(fileInput.files);
  });
}

async function handleFiles(files) {
  for (const file of files) {
    try {
      const formData = new FormData();
      formData.append('file', file);
      
      // Upload file and generate embeddings
      const response = await fetch('/api/knowledge-base/upload', {
        method: 'POST',
        body: formData
      });
      
      if (!response.ok) throw new Error('Upload failed');
      
      // Update UI
      updateFileGrid();
      updateStats();
    } catch (error) {
      console.error('Error uploading file:', error);
    }
  }
}

function updateFileGrid() {
  // Update file grid with newly uploaded files
}

function updateStats() {
  // Update knowledge base statistics
}

// Add this to your existing script
function initializeContent() {
  // Company Overview
  const companyOverview = document.getElementById('companyOverview');
  companyOverview.innerHTML = `
    <p style="margin-bottom: 1rem">
      GBP Automation Pro specializes in automating and optimizing Google Business Profile management 
      for businesses of all sizes. Our cutting-edge AI-powered platform streamlines content creation, 
      review management, and profile optimization.
    </p>
    <ul style="list-style: none; padding: 0">
      <li style="margin: 0.5rem 0">
        <i class="fas fa-check-circle" style="color: var(--primary); margin-right: 0.5rem"></i>
        Established: 2023
      </li>
      <li style="margin: 0.5rem 0">
        <i class="fas fa-check-circle" style="color: var(--primary); margin-right: 0.5rem"></i>
        Clients: 1000+
      </li>
      <li style="margin: 0.5rem 0">
        <i class="fas fa-check-circle" style="color: var(--primary); margin-right: 0.5rem"></i>
        Success Rate: 98%
      </li>
    </ul>
  `;

  // Operations News
  const operationsNews = document.getElementById('operationsNews');
  operationsNews.innerHTML = `
    <div class="news-item" style="border-bottom: 1px solid #eee; padding: 1rem 0;">
      <h4>New AI Model Integration</h4>
      <p>Enhanced content generation capabilities with latest LLM implementation.</p>
      <small style="color: var(--gray)">2 hours ago</small>
    </div>
    <div class="news-item" style="border-bottom: 1px solid #eee; padding: 1rem 0;">
      <h4>Vector Database Upgrade</h4>
      <p>Improved knowledge base search and retrieval performance.</p>
      <small style="color: var(--gray)">1 day ago</small>
    </div>
    <div class="news-item" style="padding: 1rem 0;">
      <h4>System Performance Update</h4>
      <p>30% faster response times for all API endpoints.</p>
      <small style="color: var(--gray)">2 days ago</small>
    </div>
  `;
}

// Add to your existing script
async function initializeUser() {
  try {
    const user = await window.websim.getUser();
    if (user) {
      document.getElementById('userAvatar').src = user.avatar_url || 'https://via.placeholder.com/40';
      document.getElementById('username').textContent = '@' + user.username;
      document.getElementById('userCredits').textContent = '500 credits'; // Replace with actual credits
    }
  } catch (error) {
    console.error('Error loading user data:', error);
  }
}

// Initialize knowledge base features
document.addEventListener('DOMContentLoaded', () => {
  initVectorGraph();
  initFileUpload();
  updateStats();
  initializeContent();
  initializeUser();
  initializeNotifications();
});

// Add click handler to nav items
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    item.classList.add('active');
    
    // Show corresponding content section
    const sections = ['overview', 'knowledge-base', 'content', 'analytics', 'notifications'];
    const index = Array.from(item.parentElement.children).indexOf(item);
    showSection(sections[index]);
  });
});

function showSection(section) {
  document.querySelectorAll('.main-content > div').forEach(div => div.style.display = 'none');
  document.querySelector(`.${section}-content`).style.display = 'block';
}

// Add to your existing script
function initializeNotifications() {
  // Sample notifications data - replace with actual data from your backend
  const notifications = [
    {
      id: 1,
      title: "GBP Profile Needs Immediate Update",
      content: "Critical information missing in business hours section",
      type: "urgent",
      time: "2 hours ago",
      deadline: new Date(Date.now() + 1000 * 60 * 60 * 4), // 4 hours from now
      solutions: ["Update business hours", "Verify information", "Set holiday hours"]
    },
    {
      id: 2,
      title: "Review Response Required",
      content: "3 new customer reviews pending response",
      type: "important",
      time: "1 day ago",
      deadline: new Date(Date.now() + 1000 * 60 * 60 * 24 * 2), // 2 days from now
      solutions: ["Generate AI response", "Mark as responded", "Flag for manual review"]
    },
    {
      id: 3,
      title: "Content Update Suggested",
      content: "New photos recommended for your business profile",
      type: "regular",
      time: "3 days ago",
      deadline: new Date(Date.now() + 1000 * 60 * 60 * 24 * 7), // 7 days from now
      solutions: ["Upload new photos", "Schedule photoshoot", "Skip update"]
    }
  ];

  // Render notifications by type
  renderNotifications('urgentNotifications', notifications.filter(n => n.type === 'urgent'));
  renderNotifications('importantNotifications', notifications.filter(n => n.type === 'important'));
  renderNotifications('regularNotifications', notifications.filter(n => n.type === 'regular'));
}

function renderNotifications(containerId, notifications) {
  const container = document.getElementById(containerId);
  container.innerHTML = notifications.map(notification => `
    <div class="notification-item" data-id="${notification.id}">
      <div class="notification-header">
        <div class="notification-title">${notification.title}</div>
        <div class="notification-time">${notification.time}</div>
      </div>
      <div class="notification-content">${notification.content}</div>
      <div class="notification-actions">
        <button class="notification-btn solve-btn" onclick="showSolutions(${notification.id})">
          <i class="fas fa-magic"></i> Solve
        </button>
        <button class="notification-btn archive-btn" onclick="archiveNotification(${notification.id})">
          <i class="fas fa-archive"></i> Archive
        </button>
        <button class="notification-btn delete-btn" onclick="deleteNotification(${notification.id})">
          <i class="fas fa-trash"></i> Delete
        </button>
      </div>
    </div>
  `).join('');
}

function showSolutions(notificationId) {
  // Implement solution modal or dropdown
  console.log(`Showing solutions for notification ${notificationId}`);
}

function archiveNotification(notificationId) {
  // Implement archive functionality
  console.log(`Archiving notification ${notificationId}`);
  document.querySelector(`[data-id="${notificationId}"]`).remove();
}

function deleteNotification(notificationId) {
  // Implement delete functionality
  console.log(`Deleting notification ${notificationId}`);
  document.querySelector(`[data-id="${notificationId}"]`).remove();
}

function markAllRead() {
  // Implement mark all as read functionality
  console.log('Marking all notifications as read');
  document.querySelectorAll('.notification-item').forEach(item => {
    item.style.opacity = '0.7';
  });
}

function archiveAll() {
  // Implement archive all functionality
  console.log('Archiving all notifications');
  document.querySelectorAll('.notification-item').forEach(item => {
    item.remove();
  });
}
</script>
</body></html>